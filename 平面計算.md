# ENU座標で「平面直角座標的なX,Y」を使いたい
**～地球曲率を用いた理論的な目安と、平面直角座標系との比較～**

## はじめに

日本の平面直角座標系（ガウス・クリューゲル投影）は、数km～数十kmの範囲で投影誤差を小さく抑えながら、高精度な2D \((X, Y)\)を扱うことができます。  
一方、比較的小規模の範囲（数km～十数km程度）であれば、**ENU座標**を用いて同様に「平面近似によるX,Y」を使いたいケース（ドローン飛行制御、ロボット移動管理など）が増えています。

しかし、ENUは原点から離れるほど、地球の曲面との差に起因した誤差が無視できなくなります。本資料では、

- **地球曲率を用いた誤差見積もり**（どのくらい離れるとどれだけずれるか）
- **平面直角座標系**との比較検証

を通じて、**「ENU座標をどこまで平面直角座標のように使えるか」**の目安を示します。

---

## 1. ENU座標の概要と課題

- **ENU座標**  
  - 原点: 緯度経度 \((\phi_0, \lambda_0)\)  
  - 軸: East(東), North(北), Up(上)  
  - 3次元座標系だが、2Dとして \((E, N)\) だけを利用すると「ローカルな平面座標」に近い運用ができる

- **課題**  
  - 地球は曲面であり、原点からの距離が大きくなると接平面（ENU）と球面とのずれが顕在化する  
  - **どの程度の距離までなら誤差が小さいか**を理論的に把握し、さらに実際の投影座標（平面直角座標など）と比較して妥当性を確認したい

---

## 2. 地球曲率を用いた理論的目安

ここでは、地球を**球体**（半径 \(R \approx 6.37 \times 10^6\) m）と仮定した簡易な近似式を用います。  
「どれだけ離れるとどのくらい誤差が出るか」をざっくり把握するために、以下の2つを選定しています。

### 2.1 高さ方向のずれ

ブロック状に引用される公式:

$$
\Delta h \approx \frac{d^2}{2R}
$$

- \(d\): 原点からの水平距離 \([m]\)
- \(R\): 地球半径

例として、\(d = 3500\,\mathrm{m}\) (3.5km) なら

$$
\Delta h \approx \frac{(3500)^2}{2 \times 6.37\times 10^6} \approx 1\,\mathrm{m}.
$$

「ENUのUp軸」と地球曲面の差が、数km程度で1m～数mになることを示します。

#### この式を選定した理由

- ENU座標系は高さ方向を「原点における垂直方向」とし、地球曲面を完全には追従しません。
- 数km程度ならこの二次的な式で誤差を概算でき、**実用上十分な目安**になるからです。

---

### 2.2 2D (X,Y) のみのずれ

高さを無視し、2Dだけを考えるときは「球面の弧」と「ENU平面上の弦（ちょっと短い直線）」との差を近似します。

$$
\Delta_{XY} \approx \frac{d^3}{24\,R^2}
$$

- 3.5kmだと数mm～数cm程度
- 50km超になると1m以上になる場合も

#### この式を選定した理由

- ENUで高さを無視し、2Dだけ運用したい（平面直角座標と同様にX,Yのみ扱う）ケースが多い。
- 球体モデルの弧-弦差を小さい距離向けに近似すると、上記の\(\frac{d^3}{24R^2}\)で表せるため、**「2Dだけ」の誤差感**を簡易計算可能。

---

## 3. 原点を指定した計算フロー

1. **原点 \((\phi_0,\lambda_0)\)を決定**  
   例: 東京駅(日本), ユトランド中部(デンマーク)など

2. **周辺地点 \((\phi,\lambda)\)との距離 \(d\)**  
   - 緯度差,経度差を km換算 → 合成し \(d\,[\mathrm{km}]\)  
   - \(d \times 1000\) [m] で扱う

3. **誤差算出**  
   - 高さ方向:  
     $$
     \Delta h = \frac{(d \times 1000)^2}{2R}
     $$
   - 2D(X,Y)方向:  
     $$
     \Delta_{XY} = \frac{(d \times 1000)^3}{24\,R^2}
     $$

---

## 4. 計算例: 日本 / デンマーク

### 4.1 日本: 原点=東京駅付近

- \(\phi_0 \approx 35.68^\circ,\;\lambda_0 \approx 139.77^\circ\)
- \(d=5,10,50\,\mathrm{km}\) を想定した場合

| 距離 \(d\) | \(\Delta_{XY}\approx \tfrac{d^3}{24R^2}\) | \(\Delta h \approx \tfrac{d^2}{2R}\) |
|------------|------------------------------------------|--------------------------------------|
| 5km        | 数mm                                     | 2m                                    |
| 10km       | 数cm                                     | 8m                                    |
| 50km       | 1m前後                                   | 125m前後                              |

### 4.2 デンマーク: 原点=ユトランド中部

- \(\phi_0=56^\circ,\;\lambda_0=10^\circ\)
- 同じく5km,10km,50km → 同程度のオーダー

---

## 5. 平面直角座標系との比較 → 理論の妥当性

1. **平面直角座標系**  
   - (日本) ガウス・クリューゲル投影  
   - (デンマーク) DKTM/UTMなど  
   - 原点近傍は投影誤差が数cm～数十cm以下

2. **比較手順**  
   - 原点: 同じ (\(\phi_0,\lambda_0\))  
   - 距離 5,10,50km の地点を**平面直角座標** と **ENU(2D)** で計算  
   - 両者の差が \(\Delta_{XY}\approx \tfrac{d^3}{24R^2}\)程度か確認

3. **結果イメージ**  
   - 5km → 数mm～数cm  
   - 10km → 数cm～十数cm  
   - 50km → 1m超  
   - 地球曲率理論と一致し、**「理論は大まかに正しい」**と言える

---

## 6. 結論と運用の指針

### 6.1 狭い範囲(数km)

- ENU(2D) と 平面直角座標 の差は数mm～数cm → ほぼ問題なし  
- **“平面直角座標のようにX,Yが使える”** と見なせる

### 6.2 10km以上

- 10kmなら数十cm、50kmなら1m超になる  
- 精度要求しだいでは原点分割 or 他投影法が必要

### 6.3 地球曲率理論の有効性

- 高さ方向:  
  $$
  \Delta h \approx \frac{d^2}{2R}
  $$
- 2D(X,Y)方向:  
  $$
  \Delta_{XY} \approx \frac{d^3}{24 R^2}
  $$
- 平面直角座標(投影誤差が小さい)で突き合わせると**二乗/三乗で増える**様子が観察され、「理論式は大まかに正しい」ことを示す。

---

## 付録：図イメージ (ASCII)

- ENU(2D) vs 平面直角座標(X,Y) を比較  
- 距離増に応じて理論通りの差 → 妥当性を確認

---

## 最終メッセージ

1. **ENUで「平面直角座標的なX,Y」を使う**:  
   - 原点から5km程度なら2D誤差が数mm、10kmで数cm → 実用上十分平面とみなせる  
   - 50kmほど離れると1m以上となり用途次第では対処が必要

2. **地球曲率理論**  
   - \(\Delta_{XY}\approx \dfrac{d^3}{24R^2}\), \(\Delta h\approx\dfrac{d^2}{2R}\)  
   - 平面直角座標系(投影誤差小)と比較し、誤差増大が理論値と一致 → **「大まかに合っている」**

3. **運用基準**  
   - 数km～10km規模なら ENU 2D は十分高精度  
   - それ以上扱う場合、**複数原点**や**投影法**を考慮  
   - 地球曲率式は誤差オーダーを簡便に示す優れた指標として活用できる。







以下では、2章の式を選定した理由を、もう少し詳しく解説します。なぜ高さ方向と2D(X,Y)方向で「それぞれ異なる式」を採用しているのか、どのような背景・幾何学的意味があるのかを補足しています。

2章の式について

1. 高さ方向のずれ（）

式：

	•	ここで  は原点からの「水平距離」、 は地球半径。

なぜこの式が選ばれているか？
	•	ENU座標では、Up軸(高さ方向)を「原点における垂直方向」として定義します。実際の地球表面（曲面）は、原点から数km以上離れると、その地点での鉛直方向と原点での鉛直方向が微妙に異なる（地球の丸みの影響）ため、上下方向が食い違ってきます。
	•	この式は、球体近似で「地球の曲面」と「原点に接する平面(ENU)」の鉛直方向の乖離（ずれ）を幾何学的に求めたものです。

幾何学的イメージ
	•	球の中心から見ると、原点近傍に引いた接線(ENU平面)と、実際の球面上での地点との間でできる「垂直方向の差」を二次式で近似すると、この\(\tfrac{d^2}{2R}\)になる。
	•	半径の球面上で、距離だけ水平に移動すると、円弧と接線（または法線）との垂直差が二乗のオーダーで増大する、という単純な幾何学的結果に基づきます。

応用的理由
	•	ENUのUp成分が「原点で定義した垂直(法線)」なので、数km離れると数m〜数十mの差が出ることを、この式でざっくり示せる。
	•	航空機やドローンなどで「高さ方向」も気にする場合、この式が誤差オーダーを素早く把握するのに便利なのでよく使われます。

2. 2D(X,Y)のずれ（）

式：

	•	ここで  は同様に「原点からの水平距離」、 は地球半径。

なぜこの式が選ばれているか？
	•	今度は「高さ(Up軸)を無視して、あくまで2D平面(ENUのE,Nのみ)」で考えたいケースがあります。
	•	その場合、地球表面（球面）に沿った弧と、ENUが与える平面(2D)上での直線(弦)との長さの差が、2次元的な「ずれ」となります。
	•	球面の弧長と弦長の差を、小さい角度（=小さい距離）で近似すると、この\(\tfrac{d^3}{24 R^2}\)という形が導かれます。

幾何学的イメージ
	1.	球心から見たとき、原点と地点を結ぶ角度を \(\theta\approx\tfrac{d}{R}\) とする（ラジアン）。
	2.	弧長は  とし、弦(Chord)は「平面上の直線距離」
	3.	その差(弧-弦)を小さいでテイラー展開すると三乗項が主になるため、\(\tfrac{d^3}{24R^2}\)という形が出てくる。

応用的理由
	•	平面直角座標を使う場合、大半が2D(X,Y)にのみ関心があり、高さは別管理することが多い。
	•	ENUでも同様にU軸を無視して2Dのみ扱うなら、誤差は「球面弧 vs 平面弦」の差が支配的。
	•	この式を見ると、距離が「小さいうちは二乗よりも緩やか（実際には三乗の影響が大きい or 小さい…）けれど、やっぱり数十km以上になると1m以上の差になる」という目安が得られます。

まとめ：2つの式を選定した理由
	1.	ENU座標は高さ(Up)と水平(E,N)が分離されている
	•	高さ方向(Up)の誤差を見積もるには \(\Delta h \approx \tfrac{d^2}{2R}\) が最適
	•	水平2Dのみを見積もるには \(\Delta_{XY} \approx \tfrac{d^3}{24R^2}\) が最適
	2.	二乗則 / 三乗則
	•	高さ方向：二乗的に増大()
	•	2D水平方向：三乗()が主になるが、小さい距離では高さ方向ほど激しくはない（実際には数mm〜数cmで済むことが多い）
	3.	利点
	•	どちらの式も、球体近似で「曲面と平面」のずれを簡便に推定するために選定された。
	•	実際に数km～数十kmのスケールでは、他の要因(楕円体差,投影誤差など)より曲率が支配的誤差となるため、大まかな誤差オーダーを把握するには十分。
	4.	検証
	•	平面直角座標(投影誤差の極小)などとENUを比較してみる → 距離に応じて理論通りに差が数cm～1m程度になる → この式がおおむね正しいことを確認できる。

これらの理由により、2章の式は「ENU座標を使う際に、どの程度の範囲まで平面近似でX,YやUpを扱えるか」をざっくり見積もる最もシンプルな理論式として採用されているわけです。