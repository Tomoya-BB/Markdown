緯度経度からローカル水平座標(ENU)への変換手順

背景

GPSなどで得られる位置情報は「緯度・経度・高さ」で表されます。しかし、ドローンやロボットを数km程度の範囲で制御する際には、「原点(基準点)から東に何m、北に何m」のように地図座標的な表現が扱いやすいです。

地球は球(厳密には楕円体)ですが、狭い範囲なら平面とみなしてよいです。
そのための手順は以下です。
	1.	WGS84楕円体による地球モデルを用いて、$(\phi,\lambda,h)$（緯度・経度・高さ）からECEF座標(X, Y, Z)へ変換する。
	2.	原点のECEFを基準に、ENU座標(E, N, U)へと回転変換する。

WGS84パラメータ
 - 長半径:
$$ a = 6378137.0,\text{m} $$
 - 扁平率:
$$ f = \frac{1}{298.257223563} $$
 - 第一離心率二乗:
$$ e^2 = 2f - f^2 $$

これらは地球の形状を正確にモデル化するための定数です。

座標系の定義
1. 地理座標 $(\phi, \lambda, h)$
 - 緯度 $\phi$ : 赤道を0°として北へ向かう角度
 - 経度 $\lambda$ : 本初子午線を0°として東へ向かう角度
 - 高さ $h$ : WGS84楕円体上からの高さ[m]
2. ECEF座標系 (X, Y, Z)
 - 地球中心を原点とする直交座標系
 - X軸: 本初子午線上の赤道面交点方向
 - Y軸: X軸から90°東方向
 - Z軸: 北極方向
3. ENU座標系 (E, N, U)
 - ある地点を原点とし、その地点での東(E), 北(N), 上(U)方向を軸とするローカル座標
 - 数km程度なら地球面を平面と近似でき、E,NをXY軸のように扱える。

ステップ1：緯度経度からECEFへの変換

緯度・経度をラジアンで表し、$\phi, \lambda$、高さ$h$を用いる。

法曲半径 $N(\phi)$ は、
$$ N(\phi) = \frac{a}{\sqrt{1 - e^2 \sin^2(\phi)}} $$

ECEF座標は、
$$ X = (N(\phi) + h)\cos(\phi)\cos(\lambda) $$
$$ Y = (N(\phi) + h)\cos(\phi)\sin(\lambda) $$
$$ Z = \bigl(N(\phi)(1 - e^2) + h\bigr)\sin(\phi) $$

ステップ2：原点との差分

原点(基準点)の緯度・経度・高さを $(\phi_0,\lambda_0,h_0)$ とする。
同様にECEFへ変換して $(X_0,Y_0,Z_0)$ を得る。

対象点$(\phi,\lambda,h)$のECEFを $(X,Y,Z)$ とすると、
$$ \Delta X = X - X_0 $$
$$ \Delta Y = Y - Y_0 $$
$$ \Delta Z = Z - Z_0 $$

この$(\Delta X, \Delta Y, \Delta Z)$はECEF座標系で見た原点から現在位置への3次元差分ベクトルである。

ステップ3：ECEF差分ベクトルをENUへ変換

原点位置での東・北・上方向ベクトルを定義する。
原点緯度経度を $(\phi_0,\lambda_0)$ とする。
 - 東方向(E軸)単位ベクトル:
$$
\mathbf{e} = (-\sin(\lambda_0),, \cos(\lambda_0),, 0)
$$
 - 北方向(N軸)単位ベクトル:
$$
\mathbf{n} = (-\sin(\phi_0)\cos(\lambda_0),, -\sin(\phi_0)\sin(\lambda_0),, \cos(\phi_0))
$$
 - 上方向(U軸)単位ベクトル:
$$
\mathbf{u} = (\cos(\phi_0)\cos(\lambda_0),, \cos(\phi_0)\sin(\lambda_0),, \sin(\phi_0))
$$

差分ベクトル $(\Delta X,\Delta Y,\Delta Z)$ に対し、
$$ E = \mathbf{e}\cdot(\Delta X,\Delta Y,\Delta Z) $$
$$ N = \mathbf{n}\cdot(\Delta X,\Delta Y,\Delta Z) $$
$$ U = \mathbf{u}\cdot(\Delta X,\Delta Y,\Delta Z) $$

ここで “$\cdot$” は内積を意味する。
これにより、ENU座標(E,N,U)が得られる。

ステップ4：距離の計算

原点からの水平距離は、
$$ \text{distance} = \sqrt{E^2 + N^2} $$

      北極
       |
       | Z(上方向)
       |
ECEF:  O----X軸
      /
     Y軸

(地球中心を原点とする直交座標)


(原点周辺拡大)
      
      北(N)
      ^
      |
(原点)●-------> 東(E)
      |
      ↓
      下(逆U方向)

ENU: 原点での東・北・上を軸とする局所座標系

このように、原点付近では地球曲面を平面とみなせ、(E,N)を平面座標、Uを高さ方向として扱えるため、直感的な位置表現が可能になる。

まとめ
	•	WGS84パラメータ($a,f,e^2$)を用いて緯度経度からECEF座標へ変換
	•	原点基準で差分をとり、東・北・上方向へ投影してENU座標を求める
	•	ENU座標はローカルな範囲で位置や距離を直感的に把握できる

以上が、緯度経度からENU座標へ変換する標準的手順とその数式です。